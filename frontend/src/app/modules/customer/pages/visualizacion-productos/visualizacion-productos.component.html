<h2>Productos disponibles</h2>

<div class="layout-productos">

  <aside class="sidebar-filtros">
    <section class="filtros-clasificacion">
      <h3>Filtrar por clasificación</h3>

      <div class="filtros-botones">
        <button (click)="filtrarPorClasificacion('')" [class.activo]="!clasificacionSeleccionada">Todos</button>
        <button (click)="filtrarPorClasificacion('bebidas')"
          [class.activo]="clasificacionSeleccionada === 'bebidas'">Bebidas</button>
        <button (click)="filtrarPorClasificacion('limpieza')"
          [class.activo]="clasificacionSeleccionada === 'limpieza'">Limpieza</button>
        <button (click)="filtrarPorClasificacion('almacén')"
          [class.activo]="clasificacionSeleccionada === 'almacén'">Almacén</button>
      </div>
    </section>

    <section class="filtros-precio">
      <h3>Filtrar por precio</h3>

      <div class="filtro">
        <label>Precio mínimo</label>
        <input type="number" [(ngModel)]="precioMin" />
      </div>

      <div class="filtro">
        <label>Precio máximo</label>
        <input type="number" [(ngModel)]="precioMax" />
      </div>

      <button (click)="aplicarFiltroPrecio()">Aplicar precio</button>

      <p *ngIf="errorPrecio" class="error">{{ errorPrecio }}</p>
    </section>
      <div class="filtros-precio">
              <button (click)="limpiarFiltro()">Borrar filtros</button>

      </div>
  </aside>

  <main class="productos-listado">
  <div class="productos-grid">
    <div *ngFor="let producto of productos" class="producto-card">
      <h3>{{ producto.nombre }}</h3>
      <p>{{ producto.descripcion }}</p>
      <span class="clasificacion">{{ producto.clasificacion }}</span>
      <p class="precio">{{ producto.precio | currency:'ARS' }}</p>
      <ng-container *ngIf="getItemCarrito(producto.id) as item; else agregar">
        <div class="d-flex gap-2 mt-2 align-items-stretch" style="height: 40px;">
          <p-select
            class="flex-grow-1"
            [options]="opcionesCantidad"
            [(ngModel)]="item.cantidad"
            (onChange)="cambiarCantidad(item)"
            optionValue="value"
            optionLabel="label"
            [style]="{ height: '100%' }"
          ></p-select>

          <button
            pButton
            icon="pi pi-trash"
            class="p-button-sm p-button-danger"
            (click)="eliminarProducto(item)"
            title="Quitar del carrito"
            [style]="{ height: '100%' }"
          ></button>
        </div>
      </ng-container>

      <ng-template #agregar>
        <div class="d-flex mt-2 align-items-stretch" style="height: 40px;">
          <button
            pButton
            icon="pi pi-shopping-cart"
            label="Agregar al carrito"
            class="p-button-sm p-button-success w-100"
            (click)="agregarAlCarrito(producto)"
            [disabled]="!usuarioLogueado"
            [style]="{ height: '100%' }"
          ></button>
        </div>
      </ng-template>

    </div>
  </div>
  </main>
</div>
