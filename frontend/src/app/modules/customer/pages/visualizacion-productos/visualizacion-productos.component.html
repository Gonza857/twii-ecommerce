<h2 class="text-white m-0 col-10 mx-auto py-3">Productos disponibles</h2>

<div class="layout-productos col-10 mx-auto">

  <aside class="sidebar-filtros">
    <section class="filtro-busqueda">
      <h3>Buscar por nombre</h3>
      <input type="text" [(ngModel)]="busquedaNombre" placeholder="Nombre del producto" />
      <button (click)="buscarPorNombre()">Buscar</button>
    </section>

    <section class="filtros-clasificacion">
      <h3>Filtrar por clasificación</h3>

      <div class="filtros-botones">
        <button (click)="filtrarPorClasificacion('')" [class.activo]="!clasificacionSeleccionada">Todos</button>
        <button (click)="filtrarPorClasificacion('bebidas')"
          [class.activo]="clasificacionSeleccionada === 'bebidas'">Bebidas
        </button>
        <button (click)="filtrarPorClasificacion('limpieza')"
          [class.activo]="clasificacionSeleccionada === 'limpieza'">Limpieza
        </button>
        <button (click)="filtrarPorClasificacion('almacén')"
          [class.activo]="clasificacionSeleccionada === 'almacén'">Almacén
        </button>
      </div>
    </section>

    <section class="filtros-precio">
      <h3 class="m-0">Filtrar por precio</h3>

      <div class="filtro">
        <label>Precio mínimo</label>
        <input type="number" [(ngModel)]="precioMin" />
      </div>

      <div class="filtro">
        <label>Precio máximo</label>
        <input type="number" [(ngModel)]="precioMax" />
      </div>

      <button (click)="aplicarFiltroPrecio()">Aplicar precio</button>

      <p *ngIf="errorPrecio" class="error">{{ errorPrecio }}</p>
    </section>
    <div class="filtros-precio">
      <button (click)="limpiarFiltro()">Borrar filtros</button>
    </div>
  </aside>

  <main class="productos-listado">
    <div class="productos-grid">

      @defer (when productos.length > 0) {
      @for (producto of productos; track producto.id) {
      <div class="col">
        <p-card class="h-100 shadow border-0 text-white d-flex flex-column overflow-hidden position-relative">

          <a [routerLink]="['/producto', producto.id]" class="text-decoration-none text-white">
            <div class="card-body flex-grow-1 d-flex flex-column justify-content-between">
              <div class="mb-3 d-flex align-items-center justify-content-center">
                <img [src]="producto.imagen" [alt]="producto.nombre" height="200" class="rounded"
                  style="object-fit: cover;" />
              </div>

              <div>
                <h5 class="card-title text-white">{{ producto.nombre }}</h5>
                <span class="badge bg-secundario mb-3">{{ producto.clasificacion }}</span>
              </div>

              <p class="h5 text-success mt-auto text-secundario">
                {{ producto.precio.toString() | currency: 'ARS' }}
              </p>
            </div>
          </a>
          <ng-container *ngIf="getItemCarrito(producto.id) as item; else agregar">
            <div class="d-flex gap-2 mt-2 align-items-stretch" style="height: 40px;">
              <p-select class="flex-grow-1" [options]="opcionesCantidad" [(ngModel)]="item.cantidad"
                (onChange)="cambiarCantidad(item)" optionValue="value" optionLabel="label"
                [style]="{ height: '100%' }"></p-select>

              <button pButton icon="pi pi-trash" (click)="eliminarProducto(item)" title="Quitar del carrito"
                [style]="{ height: '100%' }"></button>
            </div>
          </ng-container>

          <ng-template #agregar>
            <div class="d-flex mt-2 align-items-stretch" style="height: 40px;">
              <button class="btn-primario col-12" (click)="agregarAlCarrito(producto)" [disabled]="!usuarioLogueado"
                [style]="{ height: '100%' }">
                Agregar al carrito
              </button>
            </div>
          </ng-template>
        </p-card>
      </div>
      }

      } @placeholder {
      @for (n of [1, 2, 3, 4, 5, 6, 7]; track n) {
      <p-card class="h-100 shadow border-0 text-white d-flex flex-column overflow-hidden">
        <p-skeleton width="100%" height="11rem" styleClass="mb-2" />
        <p-skeleton width="100%" height="1.5rem" styleClass="mb-2 mt-4" />
        <p-skeleton width="5rem" styleClass="mb-2 mt-1" />
        <p-skeleton width="10rem" height="1.5rem" styleClass="mb-2 mt-3" />
        <p-skeleton width="100%" height="2.5rem" />
      </p-card>
      }
      }
      <!--  <div class="productos-grid">-->
      <!--    <div *ngFor="let producto of productos" class="producto-card">-->
      <!--      <h3>{{ producto.nombre }}</h3>-->
      <!--      <p>{{ producto.descripcion }}</p>-->
      <!--      <span class="clasificacion">{{ producto.clasificacion }}</span>-->
      <!--      <p class="precio">{{ producto.precio | currency:'ARS' }}</p>-->
      <!--      <ng-container *ngIf="getItemCarrito(producto.id) as item; else agregar">-->
      <!--        <div class="d-flex gap-2 mt-2 align-items-stretch" style="height: 40px;">-->
      <!--          <p-select-->
      <!--            class="flex-grow-1"-->
      <!--            [options]="opcionesCantidad"-->
      <!--            [(ngModel)]="item.cantidad"-->
      <!--            (onChange)="cambiarCantidad(item)"-->
      <!--            optionValue="value"-->
      <!--            optionLabel="label"-->
      <!--            [style]="{ height: '100%' }"-->
      <!--          ></p-select>-->

      <!--          <button-->
      <!--            pButton-->
      <!--            icon="pi pi-trash"-->
      <!--            class="p-button-sm p-button-danger"-->
      <!--            (click)="eliminarProducto(item)"-->
      <!--            title="Quitar del carrito"-->
      <!--            [style]="{ height: '100%' }"-->
      <!--          ></button>-->
      <!--        </div>-->
      <!--      </ng-container>-->

      <!--      <ng-template #agregar>-->
      <!--        <div class="d-flex mt-2 align-items-stretch" style="height: 40px;">-->
      <!--          <button-->
      <!--            pButton-->
      <!--            icon="pi pi-shopping-cart"-->
      <!--            label="Agregar al carrito"-->
      <!--            class="p-button-sm p-button-success w-100"-->
      <!--            (click)="agregarAlCarrito(producto)"-->
      <!--            [disabled]="!usuarioLogueado"-->
      <!--            [style]="{ height: '100%' }"-->
      <!--          ></button>-->
      <!--        </div>-->
      <!--      </ng-template>-->
    </div>
  </main>
</div>
